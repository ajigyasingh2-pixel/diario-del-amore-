<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diario di Bea</title>
<style>
  :root{
    --gold:#d4af37;
    --velvet:#5b0b12;
    --deep:#3a0608;
    --paper:#fff6ec;
    --ink:#4b1e27;
  }
  html,body{
    margin:0; padding:0; height:100%; font-family: Georgia, "Times New Roman", serif;
    background: radial-gradient(circle at 10% 10%, rgba(212,175,55,0.06), transparent 10%),
                linear-gradient(180deg,#3a0608 0%, #5b0b12 45%, #2a0506 100%);
    color: var(--ink); overflow: hidden;
  }
  body::after{
    content:""; position:fixed; inset:0; pointer-events:none;
    background-image: radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
    background-size:40px 40px; opacity:0.08;
  }

  #bookWrap{ width:94vw; max-width:760px; height:86vh; max-height:720px; margin:4vh auto; display:flex; align-items:center; justify-content:center; position:relative;}
  #book{
    width:100%; height:100%; background:linear-gradient(180deg,var(--paper),#fff0e0 60%); border-radius:18px;
    box-shadow: 0 20px 80px rgba(0,0,0,0.6), inset 0 4px 10px rgba(212,175,55,0.07);
    border:8px solid rgba(212,175,55,0.9); position:relative; overflow:hidden; perspective:2000px;
  }

  .page{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
         padding:28px; box-sizing:border-box; transform-origin:left center; transition: transform .9s cubic-bezier(.2,.9,.2,1), opacity .6s ease; }
  .hidden{ display:none !important; opacity:0; transform:translateX(10%) scale(.98); }

  #coverFace{
    position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
    background:linear-gradient(135deg, rgba(91,11,18,0.95), rgba(58,4,8,0.95));
    color:var(--gold); font-weight:700; font-size:28px; letter-spacing:1px; text-align:center; cursor:pointer;
    transition: transform .8s cubic-bezier(.2,.9,.2,1), opacity 0.6s ease;
  }
  #coverFace .sub{font-size:14px; color:rgba(255,238,210,0.9); margin-top:8px; font-weight:400;}

  .pageInner{
    width:95%; max-width:640px; height:85%; background:linear-gradient(180deg,#fffaf2,#fff3e6);
    border-radius:12px; border:2px solid rgba(212,175,55,0.12); box-shadow: 0 8px 30px rgba(0,0,0,0.25);
    padding:28px; position:relative; overflow:hidden;
  }

  .bubble {
    display:block; background: linear-gradient(180deg,#fffdf8,#fff6ee);
    border-radius:14px; padding:18px 22px; box-shadow:0 6px 20px rgba(0,0,0,0.25);
    border:2px solid rgba(212,175,55,0.25); color:var(--deep); font-size:20px; max-width:86%;
    line-height:1.4; font-family: "Georgia", serif; text-align:center;
  }

  .controls { position:absolute; bottom:18px; left:50%; transform:translateX(-50%); display:flex; gap:12px; z-index:30; }
  .btn {
    background:var(--gold); border:none; padding:10px 16px; border-radius:10px; color:var(--deep); font-weight:700; cursor:pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.25); font-family: Georgia, serif;
  }
  .btn:active{ transform:translateY(2px); }

  #interactCanvas, #starCanvas, #scratchCanvas{
    position:absolute; left:50%; transform:translateX(-50%); top:12%; width:86%; height:64%; border-radius:10px;
  }

  .pen{ position:absolute; top:12px; left:18px; z-index:40; color:var(--gold); font-size:20px; opacity:0.95; }

  #finalPage .big { font-size:34px; color:var(--deep); font-weight:800; letter-spacing:0.6px; text-align:center; }

  @media(max-width:600px){
    #bookWrap{ height:92vh; margin-top:2vh; }
    .bubble{ font-size:18px; padding:14px; }
  }

  /* petali */
  .petal{ position:fixed; width:12px; height:12px; border-radius:50%; pointer-events:none; z-index:1; }
</style>
</head>
<body>
<div id="bookWrap">
  <div id="book" role="application" aria-label="Diario di Bea">
    <!-- COVER -->
    <div id="coverFace" class="page">
      <div style="text-align:center;">
        <div style="font-size:60px;">‚ù§Ô∏è</div>
        <div style="font-family:Georgia,serif;font-weight:900;font-size:34px">Il Diario di Bea</div>
        <div class="sub">Tocca per aprire e scoprire i miei pensieri üíå</div>
      </div>
    </div>

    <!-- PAGE 1: hearts -->
    <div id="page1" class="page hidden" aria-hidden="true">
      <div class="pageInner">
        <div style="position:absolute;left:22px;top:18px;" class="pen">‚úíÔ∏è</div>
        <div style="margin-top:6px;font-family:Georgia,serif;color:var(--deep);font-size:20px;text-align:center;">
          <div style="margin-bottom:10px;">Pagina 1 ‚Äî Cuori d'Amore</div>
          <div class="bubble" id="p1bubble">Tocca tutti i cuori che cadono dal cielo per scoprire il messaggio üíñ</div>
        </div>
        <canvas id="interactCanvas"></canvas>
        <div class="controls">
          <button class="btn" id="p1Next" style="display:none">Prosegui ‚ûú</button>
        </div>
      </div>
    </div>

    <!-- PAGE 2: stars -->
    <div id="page2" class="page hidden" aria-hidden="true">
      <div class="pageInner">
        <div style="position:absolute;left:22px;top:18px;" class="pen">‚úíÔ∏è</div>
        <div style="margin-top:6px;font-family:Georgia,serif;color:var(--deep);font-size:20px;text-align:center;">
          <div style="margin-bottom:10px;">Pagina 2 ‚Äî Stelle Magiche</div>
          <div class="bubble" id="p2bubble">Tocca tutte le stelle per farle brillare ‚ú®</div>
        </div>
        <canvas id="starCanvas"></canvas>
        <div class="controls">
          <button class="btn" id="p2Next" style="display:none">Prosegui ‚ûú</button>
          <button class="btn" id="p2Back">‚óÄ Indietro</button>
        </div>
      </div>
    </div>

    <!-- PAGE 3: scratch -->
    <div id="page3" class="page hidden" aria-hidden="true">
      <div class="pageInner">
        <div style="position:absolute;left:22px;top:18px;" class="pen">‚úíÔ∏è</div>
        <div style="margin-top:6px;font-family:Georgia,serif;color:var(--deep);font-size:20px;text-align:center;">
          <div style="margin-bottom:10px;">Pagina 3 ‚Äî Segreto Nascosto</div>
          <div class="bubble" id="p3bubble">Gratta la superficie per scoprire il mio pensiero pi√π dolce üíå</div>
        </div>
        <canvas id="scratchCanvas"></canvas>
        <div class="controls">
          <button class="btn" id="p3Next" style="display:none">Chiudi il diario üíû</button>
          <button class="btn" id="p3Back">‚óÄ Indietro</button>
        </div>
      </div>
    </div>

    <!-- FINAL PAGE -->
    <div id="finalPage" class="page hidden" aria-hidden="true">
      <div class="pageInner" style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
        <div class="big" id="finalPhrase"> </div>
        <div style="margin-top:20px;"><button class="btn" id="restartBtn">Ricomincia</button></div>
      </div>
    </div>

  </div>
</div>

<script>
let pages = ['coverFace','page1','page2','page3','finalPage'];
let currentPage = 0;
function showPage(index){
  pages.forEach((id,i)=>{
    let el = document.getElementById(id);
    if(i===index){ el.classList.remove('hidden'); el.setAttribute('aria-hidden','false'); }
    else{ el.classList.add('hidden'); el.setAttribute('aria-hidden','true'); }
  });
  currentPage=index;
  if(index===1) initPage1();
  if(index===2) initPage2();
  if(index===3) initPage3();
  if(index===4) initFinal();
}

/* COVER */
document.getElementById('coverFace').addEventListener('click',()=>{ showPage(1); });

/* ---------------- Page 1 - Cuori ---------------- */
let interactCanvas = document.getElementById('interactCanvas');
let ictx, hearts=[], heartCollected=0, heartSpawnTimer;
function initPage1(){
  ictx = interactCanvas.getContext('2d');
  ictx.canvas.width = interactCanvas.offsetWidth;
  ictx.canvas.height = interactCanvas.offsetHeight;
  hearts=[]; heartCollected=0; document.getElementById('p1Next').style.display='none';
  spawnHearts();
  requestAnimationFrame(drawHearts);
}
function spawnHearts(){
  clearInterval(heartSpawnTimer);
  heartSpawnTimer=setInterval(()=>{
    if(hearts.length<10){
      let r=16+Math.random()*8;
      let x=Math.random()*(ictx.canvas.width-2*r)+r;
      let y=ictx.canvas.height-10;
      let speed=0.6+Math.random()*1.1;
      hearts.push({x,y,r:speed,size:r});
    }
  },400);
}
function drawHearts(){
  ictx.clearRect(0,0,ictx.canvas.width,ictx.canvas.height);
  for(let i=hearts.length-1;i>=0;i--){
    let h=hearts[i];
    h.y-=h.r;
    ictx.fillStyle="#ff5366";
    ictx.beginPath();
    ictx.moveTo(h.x,h.y-h.size/2);
    ictx.bezierCurveTo(h.x+h.size,h.y-h.size*1.3,h.x+h.size*1.5,h.y+h.size/3,h.x,h.y+h.size);
    ictx.bezierCurveTo(h.x-h.size*1.5,h.y+h.size/3,h.x-h.size,h.y-h.size*1.3,h.x,h.y-h.size/2);
    ictx.fill();
    if(h.y+h.size<-20) hearts.splice(i,1);
  }
  requestAnimationFrame(drawHearts);
}
interactCanvas.addEventListener('click',clickHeart);
interactCanvas.addEventListener('touchstart',clickHeart);
function clickHeart(e){
  const rect = interactCanvas.getBoundingClientRect();
  let x = (e.touches?e.touches[0].clientX:e.clientX)-rect.left;
  let y = (e.touches?e.touches[0].clientY:e.clientY)-rect.top;
  for(let i=hearts.length-1;i>=0;i--){
    let h=hearts[i];
    if(Math.hypot(x-h.x,y-h.y)<h.size){
      hearts.splice(i,1); heartCollected++;
      if(heartCollected>=7){
        document.getElementById('p1bubble').textContent="Bea, ogni battito del mio cuore scrive il tuo nome üíñ";
        document.getElementById('p1Next').style.display='inline-block';
        clearInterval(heartSpawnTimer);
      }
      break;
    }
  }
}
document.getElementById('p1Next').addEventListener('click',()=>showPage(2));

/* ---------------- Page 2 - Stelle ---------------- */
let starCanvas=document.getElementById('starCanvas');
let sctx, stars=[];
function initPage2(){
  sctx=starCanvas.getContext('2d');
  sctx.canvas.width=starCanvas.offsetWidth;
  sctx.canvas.height=starCanvas.offsetHeight;
  stars=[];
  document.getElementById('p2Next').style.display='none';
  for(let i=0;i<6;i++){
    stars.push({x:40+Math.random()*(sctx.canvas.width-80),y:30+Math.random()*(sctx.canvas.height-60),lit:false,r:8});
  }
  drawStars();
}
function drawStars(){
  sctx.clearRect(0,0,sctx.canvas.width,sctx.canvas.height);
  for(let s of stars){
    sctx.beginPath();
    sctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    sctx.fillStyle=s.lit?'#ffd662':'rgba(255,215,0,0.25)';
    sctx.fill();
    if(s.lit){
      sctx.beginPath();
      sctx.arc(s.x,s.y,s.r+8,0,Math.PI*2);
      sctx.fillStyle='rgba(255,215,0,0.08)'; sctx.fill();
    }
  }
}
starCanvas.addEventListener('click',lightStar);
starCanvas.addEventListener('touchstart',lightStar);
function lightStar(e){
  const rect=starCanvas.getBoundingClientRect();
  let x=(e.touches?e.touches[0].clientX:e.clientX)-rect.left;
  let y=(e.touches?e.touches[0].clientY:e.clientY)-rect.top;
  for(let s of stars){
    if(Math.hypot(x-s.x,y-s.y)<18) s.lit=true;
  }
  drawStars();
  if(stars.every(s=>s.lit)){
    document.getElementById('p2bubble').textContent="Ogni tuo sorriso accende il mio cielo ‚ú®";
    document.getElementById('p2Next').style.display='inline-block';
  }
}
document.getElementById('p2Next').addEventListener('click',()=>showPage(3));
document.getElementById('p2Back').addEventListener('click',()=>showPage(1));

/* ---------------- Page 3 - Scratch ---------------- */
let scratchCanvas=document.getElementById('scratchCanvas');
let scrCtx, scratching=false;
function initPage3(){
  scrCtx=scratchCanvas.getContext('2d');
  scrCtx.canvas.width=scratchCanvas.offsetWidth;
  scrCtx.canvas.height=scratchCanvas.offsetHeight;
  scrCtx.fillStyle="#9b9b9b";
  scrCtx.fillRect(0,0,scrCtx.canvas.width,scrCtx.canvas.height);
  scratchCanvas.addEventListener('mousedown',startScratch);
  scratchCanvas.addEventListener('mousemove',scratchMove);
  window.addEventListener('mouseup',endScratch);
  scratchCanvas.addEventListener('touchstart',startScratch);
  scratchCanvas.addEventListener('touchmove',scratchMove);
  scratchCanvas.addEventListener('touchend',endScratch);
}
function startScratch(e){ scratching=true; scratchMove(e);}
function endScratch(){ scratching=false; checkScratch();}
function scratchMove(e){
  if(!scratching) return;
  const rect=scratchCanvas.getBoundingClientRect();
  let x=(e.touches?e.touches[0].clientX:e.clientX)-rect.left;
  let y=(e.touches?e.touches[0].clientY:e.clientY)-rect.top;
  scrCtx.globalCompositeOperation='destination-out';
  scrCtx.beginPath();
  scrCtx.arc(x,y,24,0,Math.PI*2); scrCtx.fill();
}
function checkScratch(){
  try{
    let pixels=scrCtx.getImageData(0,0,scrCtx.canvas.width,scrCtx.canvas.height).data;
    let cleared=0;
    for(let i=3;i<pixels.length;i+=4) if(pixels[i]===0) cleared++;
    if(cleared/(scrCtx.canvas.width*scrCtx.canvas.height)>0.35){
      document.getElementById('p3bubble').textContent="Se potessi, ti terrei tra queste righe per sempre üíå";
      document.getElementById('p3Next').style.display='inline-block';
    }
  }catch(e){}
}
document.getElementById('p3Next').addEventListener('click',()=>showPage(4));
document.getElementById('p3Back').addEventListener('click',()=>showPage(2));

/* ---------------- Final page ---------------- */
function initFinal(){
  const el=document.getElementById('finalPhrase'); el.textContent="";
  typeWriter("Bea, tu sei la mia storia pi√π bella üìñüíû",el);
  for(let i=0;i<30;i++){
    let pet=document.createElement('div'); pet.className='petal';
    pet.style.backgroundColor='#ff6a88'; pet.style.left=Math.random()*window.innerWidth+'px';
    pet.style.top='-20px'; pet.style.width=12+Math.random()*6+'px';
    pet.style.height=12+Math.random()*6+'px'; pet.style.opacity=0.8;
    document.body.appendChild(pet);
    animatePetal(pet);
  }
  document.getElementById('restartBtn').addEventListener('click',()=>showPage(0));
}
function typeWriter(text,el,i=0){
  if(i<text.length){ el.textContent+=text[i]; setTimeout(()=>typeWriter(text,el,i+1),55);}
}
function animatePetal(el){
  let speedY=1+Math.random()*2;
  let speedX=(Math.random()-0.5)*0.8;
  function move(){
    let top=parseFloat(el.style.top);
    let left=parseFloat(el.style.left);
    top+=speedY; left+=speedX;
    if(top>window.innerHeight){ el.remove(); return;}
    el.style.top=top+'px'; el.style.left=left+'px';
    requestAnimationFrame(move);
  }
  move();
}

</script>
</body>
</html>
